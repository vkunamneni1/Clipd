// userscript for managing clipboard history
// Hack Club FixIt

(function(){'use strict';const HISTORY_KEY='clipboard_history',MAX_ITEMS=20;let expanded=false,searchQuery='';function loadHistory(){try{return JSON.parse(localStorage.getItem(HISTORY_KEY))||[]}catch{return[]}}function saveHistory(h){localStorage.setItem(HISTORY_KEY,JSON.stringify(h.slice(0,MAX_ITEMS)))}function addToHistory(t){const h=loadHistory();if(t&&t.trim()&&h[0]!==t){h.unshift(t);saveHistory(h);renderHistory()}}function toggleHistory(){expanded=!expanded;updateUI()}function exportToCSV(){const h=loadHistory(),csv="data:text/csv;charset=utf-8,"+h.map((e,i)=>`"${i+1}","${e.replace(/"/g,'""')}"`).join("\n"),uri=encodeURI(csv),a=document.createElement('a');a.href=uri;a.download='clipboard_history.csv';document.body.appendChild(a);a.click();document.body.removeChild(a)}function updateUI(){const c=getOrCreateContainer();c.innerHTML='';const toggle=createToggleButton();c.appendChild(toggle);if(!expanded)return;const s=document.createElement('input');s.type='text';s.placeholder='Search...';Object.assign(s.style,{padding:'5px',border:'1px solid #444',borderRadius:'4px',marginBottom:'6px',width:'100%',boxSizing:'border-box'});s.value=searchQuery;s.oninput=()=>{searchQuery=s.value.toLowerCase();renderHistory()};s.id='clipboard-search';c.appendChild(s);const content=document.createElement('div');content.id='clipboard-content';content.style.width='100%';content.style.display='flex';content.style.flexDirection='column';content.style.gap='6px';c.appendChild(content);renderHistory()}function renderHistory(){const content=document.getElementById('clipboard-content');if(!content)return;content.innerHTML='';const h=loadHistory().filter(x=>x.toLowerCase().includes(searchQuery));h.forEach((item)=>{const b=document.createElement('button');b.innerText=item.length>50?item.slice(0,50)+'â€¦':item;b.title=item;styleHistoryButton(b);b.onclick=()=>{navigator.clipboard.writeText(item).then(()=>{b.innerText='âœ” Copied!';setTimeout(renderHistory,1000)})};content.appendChild(b)});const exportBtn=document.createElement('button');exportBtn.innerText='ðŸ“¤ Export CSV';styleExportButton(exportBtn);exportBtn.onclick=exportToCSV;content.appendChild(exportBtn)}function getOrCreateContainer(){let c=document.getElementById('clipboard-history');if(!c){c=document.createElement('div');c.id='clipboard-history';Object.assign(c.style,{position:'fixed',top:'10px',right:'10px',zIndex:'9999',background:'rgba(0,0,0,0.85)',borderRadius:'8px',padding:'10px',fontFamily:'monospace',fontSize:'12px',color:'#fff',boxShadow:'0 2px 8px rgba(0,0,0,0.3)',maxWidth:'300px',display:'flex',flexDirection:'column',alignItems:'flex-start',gap:'6px'});document.body.appendChild(c)}return c}function createToggleButton(){const b=document.createElement('button');b.innerText=expanded?'ðŸ“‹ Hide History':'ðŸ“‹ Show Clipboard';Object.assign(b.style,{all:'unset',padding:'6px 10px',border:'1px solid #444',borderRadius:'5px',background:'#222',color:'#fff',cursor:'pointer',marginBottom:'5px'});b.onclick=toggleHistory;return b}function styleHistoryButton(b){Object.assign(b.style,{all:'unset',padding:'5px 8px',border:'1px solid #444',borderRadius:'5px',background:'#333',color:'#fff',cursor:'pointer',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'})}function styleExportButton(b){Object.assign(b.style,{all:'unset',padding:'5px 8px',border:'1px solid #666',borderRadius:'5px',background:'#114',color:'#8ef',cursor:'pointer',fontWeight:'bold'})}document.addEventListener('copy',async()=>{try{const text=await navigator.clipboard.readText();addToHistory(text)}catch(e){}});updateUI();(async()=>{try{const text=await navigator.clipboard.readText();addToHistory(text)}catch(e){}})();})();