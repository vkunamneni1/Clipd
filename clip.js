// ==UserScript==
// @name         Clipd
// @namespace    https://github.com/vkunamneni1/Clipd
// @version      1.0
// @description  Clipboard history with search capabilites, CSV export, and cross tab save history
// @match        *://*/*
// @grant        none
// ==/UserScript==

(()=>{const key='clipDB',cap=20,sync=new BroadcastChannel('clipSync'),$=e=>document.getElementById(e),initUI=()=>{const d=$('clipHost')||Object.assign(document.body.appendChild(document.createElement('div')),{id:'clipHost'});Object.assign(d.style,{position:'fixed',top:'10px',right:'10px',zIndex:'9999',background:'#000',color:'#eee',font:'13px sans-serif',border:'1px solid #333',padding:'14px',display:'flex',flexDirection:'column',alignItems:'center',gap:'10px',maxWidth:'320px',boxShadow:'0 0 12px #000',borderRadius:'0'});d.innerHTML='';d.appendChild(btn());if(view)showTools(d)},btn=()=>{const b=document.createElement('button');b.textContent=view?'Hide History':'Show Clipboard';style(b,'#111','#8ef','#181818');b.onclick=()=>{view=!view;initUI()};return b},clipList=()=>JSON.parse(localStorage.getItem(key)||'[]'),saveList=l=>localStorage.setItem(key,JSON.stringify(l.slice(0,cap))),addClip=(t,push=true)=>{if(!t||!t.trim())return;const l=clipList();if(t!==l[0]){l.unshift(t);saveList(l);push&&sync.postMessage(t);render()}},searchBox=()=>{const i=document.createElement('input');Object.assign(i.style,{padding:'8px',border:'1px solid #444',borderRadius:'0',width:'100%',background:'#111',color:'#ccc'});i.placeholder='Search...';i.value=q;i.oninput=()=>{q=i.value.toLowerCase();render()};return i},style=(el,bg,fg,hv)=>{Object.assign(el.style,{all:'unset',padding:'10px',width:'100%',border:'1px solid #444',borderRadius:'0',background:bg,color:fg,cursor:'pointer'});el.onmouseenter=()=>el.style.background=hv;el.onmouseleave=()=>el.style.background=bg},render=()=>{const box=$('clipPanel');if(!box)return;box.innerHTML='';for(const txt of clipList().filter(x=>x.toLowerCase().includes(q))){const b=document.createElement('button');b.textContent=txt.length>60?txt.slice(0,60)+'â€¦':txt;b.title=txt;style(b,'#121212','#ccc','#1a1a1a');b.onclick=()=>navigator.clipboard.writeText(txt).then(()=>{b.textContent='Copied';setTimeout(render,800)});box.appendChild(b)};const clear=document.createElement('button');clear.textContent='Clear History';style(clear,'#220000','#faa','#330000');clear.onclick=()=>{localStorage.removeItem(key);render()};box.appendChild(clear)},showTools=d=>{d.appendChild(searchBox());const c=document.createElement('div');c.id='clipPanel';Object.assign(c.style,{display:'flex',flexDirection:'column',gap:'8px',width:'100%'});d.appendChild(c);render()},view=false,q='';document.addEventListener('copy',()=>navigator.clipboard.readText().then(txt=>addClip(txt)));sync.onmessage=e=>addClip(e.data,false);initUI();navigator.clipboard.readText().then(txt=>addClip(txt))})();

// userscript for managing clipboard history
// Hack Club FixIt