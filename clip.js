// ==UserScript==
// @name         Clipd
// @namespace    https://github.com/vkunamneni1/Clipd
// @version      1.0
// @description  Clipboard history with search capabilites, CSV export, and cross tab save history
// @match        *://*/*
// @grant        none
// ==/UserScript==

(function(){'use strict';const storageKey='clipboardItems',maxItems=20,bus=new BroadcastChannel('clipSync');let isVisible=false,query='';function fetchClips(){try{return JSON.parse(localStorage.getItem(storageKey))||[]}catch{return[]}}function storeClips(items){localStorage.setItem(storageKey,JSON.stringify(items.slice(0,maxItems)))}function insertClip(text,share=true){const items=fetchClips();if(text&&text.trim()&&items[0]!==text){items.unshift(text);storeClips(items);if(share)bus.postMessage({type:'newClip',text});updateList()}}function togglePanel(){isVisible=!isVisible;renderPanel()}function downloadCSV(){const items=fetchClips(),lines=items.map((v,i)=>`"${i+1}","${v.replace(/"/g,'""')}"`).join("\n"),blob=new Blob([lines],{type:'text/csv'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download='clipboard.csv';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url)}function wipeHistory(){localStorage.removeItem(storageKey);updateList()}function renderPanel(){const box=getPanel();box.innerHTML='';box.appendChild(makeToggle());if(!isVisible)return;const search=document.createElement('input');Object.assign(search.style,{padding:'8px',border:'1px solid #444',borderRadius:'0',marginBottom:'10px',width:'100%',background:'#111',color:'#ccc',fontSize:'13px'});search.placeholder='Search...';search.value=query;search.oninput=()=>{query=search.value.toLowerCase();updateList()};search.id='clipSearch';box.appendChild(search);const wrap=document.createElement('div');wrap.id='clipList';wrap.style.display='flex';wrap.style.flexDirection='column';wrap.style.gap='8px';box.appendChild(wrap);updateList()}function updateList(){const wrap=document.getElementById('clipList');if(!wrap)return;wrap.innerHTML='';const items=fetchClips().filter(x=>x.toLowerCase().includes(query));for(const entry of items){const btn=document.createElement('button');btn.innerText=entry.length>60?entry.slice(0,60)+'â€¦':entry;btn.title=entry;styleItem(btn);btn.onclick=()=>{navigator.clipboard.writeText(entry).then(()=>{btn.innerText='Copied';setTimeout(updateList,1000)})};wrap.appendChild(btn)}const saveBtn=document.createElement('button');saveBtn.innerText='Export CSV';styleAction(saveBtn);saveBtn.onclick=downloadCSV;wrap.appendChild(saveBtn);const clearBtn=document.createElement('button');clearBtn.innerText='Clear History';styleClear(clearBtn);clearBtn.onclick=wipeHistory;wrap.appendChild(clearBtn)}function getPanel(){let box=document.getElementById('clipOverlay');if(!box){box=document.createElement('div');box.id='clipOverlay';Object.assign(box.style,{position:'fixed',top:'10px',right:'10px',zIndex:'9999',background:'#000',border:'1px solid #333',borderRadius:'0',padding:'14px',fontFamily:'"Helvetica Neue",sans-serif',fontSize:'13px',color:'#eee',boxShadow:'0 4px 16px rgba(0,0,0,0.6)',maxWidth:'320px',display:'flex',flexDirection:'column',alignItems:'center',gap:'10px'});document.body.appendChild(box)}return box}function makeToggle(){const btn=document.createElement('button');btn.innerText=isVisible?'Hide History':'Show Clipboard';Object.assign(btn.style,{all:'unset',padding:'10px 14px',border:'1px solid #666',borderRadius:'0',background:'#111',color:'#8ef',cursor:'pointer',fontWeight:'500',letterSpacing:'0.5px',marginBottom:'8px',textTransform:'uppercase',transition:'0.3s'});btn.onmouseenter=()=>btn.style.background='#181818';btn.onmouseleave=()=>btn.style.background='#111';btn.onclick=togglePanel;return btn}function styleItem(btn){Object.assign(btn.style,{all:'unset',padding:'8px 10px',border:'1px solid #444',borderRadius:'0',background:'#121212',color:'#ccc',cursor:'pointer',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',transition:'0.2s'});btn.onmouseenter=()=>btn.style.background='#1a1a1a';btn.onmouseleave=()=>btn.style.background='#121212'}function styleAction(btn){Object.assign(btn.style,{all:'unset',padding:'8px 10px',border:'1px solid #444',borderRadius:'0',background:'#002244',color:'#8ef',cursor:'pointer',fontWeight:'bold',marginTop:'6px',transition:'0.2s'});btn.onmouseenter=()=>btn.style.background='#003366';btn.onmouseleave=()=>btn.style.background='#002244'}function styleClear(btn){Object.assign(btn.style,{all:'unset',padding:'8px 10px',border:'1px solid #555',borderRadius:'0',background:'#220000',color:'#faa',cursor:'pointer',fontWeight:'bold',transition:'0.2s'});btn.onmouseenter=()=>btn.style.background='#330000';btn.onmouseleave=()=>btn.style.background='#220000'}document.addEventListener('copy',async()=>{try{const text=await navigator.clipboard.readText();insertClip(text)}catch(e){}});bus.onmessage=(e)=>{if(e.data?.type==='newClip')insertClip(e.data.text,false)};renderPanel();(async()=>{try{const text=await navigator.clipboard.readText();insertClip(text)}catch(e){}})();})();

// userscript for managing clipboard history
// Hack Club FixIt