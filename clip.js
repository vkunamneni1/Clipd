// ==UserScript==
// @name         Clipd
// @namespace    https://github.com/vkunamneni1/Clipd
// @version      1.0
// @description  Clipboard history with search capabilites, CSV export, and cross tab save history
// @match        *://*/*
// @grant        none
// ==/UserScript==

(function(){'use strict';const HISTORY_KEY='clipboard_history',MAX_ITEMS=20,channel=new BroadcastChannel('clipboard_sync');let expanded=false,searchQuery='';function loadHistory(){try{return JSON.parse(localStorage.getItem(HISTORY_KEY))||[]}catch{return[]}}function saveHistory(h){localStorage.setItem(HISTORY_KEY,JSON.stringify(h.slice(0,MAX_ITEMS)))}function addToHistory(t,broadcast=true){const h=loadHistory();if(t&&t.trim()&&h[0]!==t){h.unshift(t);saveHistory(h);if(broadcast)channel.postMessage({type:'clipboard',text:t});renderHistory()}}function toggleHistory(){expanded=!expanded;updateUI()}function exportToCSV(){const h=loadHistory(),csv="data:text/csv;charset=utf-8,"+h.map((e,i)=>`"${i+1}","${e.replace(/"/g,'""')}"`).join("\n"),uri=encodeURI(csv),a=document.createElement('a');a.href=uri;a.download='clipboard_history.csv';document.body.appendChild(a);a.click();document.body.removeChild(a)}function clearHistory(){localStorage.removeItem(HISTORY_KEY);renderHistory()}function updateUI(){const c=getOrCreateContainer();c.innerHTML='';const toggle=createToggleButton();c.appendChild(toggle);if(!expanded)return;const s=document.createElement('input');s.type='text';s.placeholder='Search clips...';Object.assign(s.style,{padding:'8px',border:'1px solid #444',borderRadius:'0',marginBottom:'10px',width:'100%',boxSizing:'border-box',background:'#111',color:'#ccc',fontSize:'13px'});s.value=searchQuery;s.oninput=()=>{searchQuery=s.value.toLowerCase();renderHistory()};s.id='clipboard-search';c.appendChild(s);const content=document.createElement('div');content.id='clipboard-content';content.style.width='100%';content.style.display='flex';content.style.flexDirection='column';content.style.gap='8px';c.appendChild(content);renderHistory()}function renderHistory(){const content=document.getElementById('clipboard-content');if(!content)return;content.innerHTML='';const h=loadHistory().filter(x=>x.toLowerCase().includes(searchQuery));h.forEach((item)=>{const b=document.createElement('button');b.innerText=item.length>60?item.slice(0,60)+'â€¦':item;b.title=item;styleHistoryButton(b);b.onclick=()=>{navigator.clipboard.writeText(item).then(()=>{b.innerText='Copied';setTimeout(renderHistory,1000)})};content.appendChild(b)});const exportBtn=document.createElement('button');exportBtn.innerText='Export CSV';styleExportButton(exportBtn);exportBtn.onclick=exportToCSV;content.appendChild(exportBtn);const clearBtn=document.createElement('button');clearBtn.innerText='Clear History';styleClearButton(clearBtn);clearBtn.onclick=clearHistory;content.appendChild(clearBtn)}function getOrCreateContainer(){let c=document.getElementById('clipboard-history');if(!c){c=document.createElement('div');c.id='clipboard-history';Object.assign(c.style,{position:'fixed',top:'10px',right:'10px',zIndex:'9999',background:'#000',border:'1px solid #333',borderRadius:'0',padding:'14px',fontFamily:'"Helvetica Neue",sans-serif',fontSize:'13px',color:'#eee',boxShadow:'0 4px 16px rgba(0,0,0,0.6)',maxWidth:'320px',display:'flex',flexDirection:'column',alignItems:'center',gap:'10px'});document.body.appendChild(c)}return c}function createToggleButton(){const b=document.createElement('button');b.innerText=expanded?'Hide History':'Show Clipboard';Object.assign(b.style,{all:'unset',padding:'10px 14px',border:'1px solid #666',borderRadius:'0',background:'#111',color:'#8ef',cursor:'pointer',fontWeight:'500',letterSpacing:'0.5px',marginBottom:'8px',textTransform:'uppercase',transition:'0.3s'});b.onmouseenter=()=>b.style.background='#181818';b.onmouseleave=()=>b.style.background='#111';b.onclick=toggleHistory;return b}function styleHistoryButton(b){Object.assign(b.style,{all:'unset',padding:'8px 10px',border:'1px solid #444',borderRadius:'0',background:'#121212',color:'#ccc',cursor:'pointer',whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',transition:'0.2s'});b.onmouseenter=()=>b.style.background='#1a1a1a';b.onmouseleave=()=>b.style.background='#121212'}function styleExportButton(b){Object.assign(b.style,{all:'unset',padding:'8px 10px',border:'1px solid #444',borderRadius:'0',background:'#002244',color:'#8ef',cursor:'pointer',fontWeight:'bold',marginTop:'6px',transition:'0.2s'});b.onmouseenter=()=>b.style.background='#003366';b.onmouseleave=()=>b.style.background='#002244'}function styleClearButton(b){Object.assign(b.style,{all:'unset',padding:'8px 10px',border:'1px solid #555',borderRadius:'0',background:'#220000',color:'#faa',cursor:'pointer',fontWeight:'bold',transition:'0.2s'});b.onmouseenter=()=>b.style.background='#330000';b.onmouseleave=()=>b.style.background='#220000'}document.addEventListener('copy',async()=>{try{const text=await navigator.clipboard.readText();addToHistory(text)}catch(e){}});channel.onmessage=(e)=>{if(e.data?.type==='clipboard')addToHistory(e.data.text,false)};updateUI();(async()=>{try{const text=await navigator.clipboard.readText();addToHistory(text)}catch(e){}})();})();

// userscript for managing clipboard history
// Hack Club FixIt